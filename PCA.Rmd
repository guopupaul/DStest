---
title: "Which boxscore features"
output: html_notebook
---


```{r}
library(stringr)
library(dplyr)
library(readxl)
library(tidyr)
library(ggplot2)
library("FactoMineR")
library("factoextra")
library("corrplot")
boxscores <- read_excel("YL1 2019.xlsx", sheet = 2, range = "A1:Y271",col_names = TRUE)
glimpse(boxscores)
boxscores.active <- boxscores %>% select(3:22) %>% select(-c("3P%","2P%","FT%"))
boxscores.active <- sapply(boxscores.active, as.numeric)
boxscores.active <- as.data.frame(boxscores.active)
```

PCA
```{r}
res.pca <- PCA(boxscores.active, graph = FALSE)
eig.val <- get_eigenvalue(res.pca)
eig.val
```
An eigenvalue > 1 indicates that PCs account for more variance than accounted by one of the original variables in standardized data. This is commonly used as a cutoff point for which PCs are retained. This holds true only when the data are standardized.

You can also limit the number of component to that number that accounts for a certain fraction of the total variance. For example, if you are satisfied with 70% of the total variance explained then use the number of components to achieve that.

In this case, 5 dimensions > 1 and cover and cover 70% of the variance.
An alternative method to determine the number of principal components is to look at a Scree Plot, which is the plot of eigenvalues ordered from largest to the smallest. The number of component is determined at the point, beyond which the remaining eigenvalues are all relatively small and of comparable size
```{r}
fviz_screeplot(res.pca, addlabels = TRUE, ylim = c(0, 25))
```
6 dimensions still looks right.
The quality of representation of the variables on factor map is called cos2 (square cosine, squared coordinates). You can visualize the cos2 of variables on all the dimensions using the corrplot package:
```{r}
var <- get_pca_var(res.pca)
var
corrplot(var$cos2, is.corr=FALSE)
```
Note that, A high cos2 indicates a good representation of the variable on the principal component. In this case the variable is positioned close to the circumference of the correlation circle.
A low cos2 indicates that the variable is not perfectly represented by the PCs. In this case the variable is close to the center of the circle.

The cos2 values are used to estimate the quality of the representation
The closer a variable is to the circle of correlations, the better its representation on the factor map (and the more important it is to interpret these components)
Variables that are closed to the center of the plot are less important for the first components. A summary visualisation is below.
```{r}
fviz_pca_var(res.pca, col.var = "cos2", gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"), 
repel = TRUE) # Avoid text overlapping
```

Itâ€™s possible to use the function corrplot() [corrplot package] to highlight the most contributing variables for each dimension:
```{r}
corrplot(var$contrib, is.corr=FALSE) 
#a visualisation
fviz_contrib(res.pca, choice = "var", axes = 1:5, top = 17)
```
The red dashed line on the graph above indicates the expected average contribution. If the contribution of the variables were uniform, the expected value would be 1/length(variables) = 1/17. For a given component, a variable with a contribution larger than this cutoff could be considered as important in contributing to the component.
```{r}
res <- PCA(boxscores,quali.sup=c(1:2, 23:25),graph=F)
library(FactoInvestigate)
Investigate(res,document="pdf_document")
```
RegBest(y,x, int = TRUE, wt=NULL, na.action = na.omit,
method=c("r2","Cp", "adjr2"), nbest=1)
f <- RegBest(boxscores$RESULT, boxscores.active)
